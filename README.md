# Collimator-Segmentation-with-Keras
Use Keras to segment collimator shadow with a UNET and by fitting shadow with a rectangle

Keras implementation of using convolutional neural nets to segment the x-ray collimator shadow in a projection image.  The collimator controls the size and shape of the x-ray field coming out of the x-ray tube for focusing the radiation accordingly to the area of interest. Depending on the patientâ€™s illuminated anatomy the recorded signal can vary substantially within the collimated region. Also due to x-ray scatter from the illuminated anatomy there can be substantial exposure outside of the exposure region.   Two approaches were used to segment the collimator shadow: 1) The first approach uses a UNet convolutional neural network to segment the collimator shadow. For this approach the network classifies whether a pixel was in or out of the collimator shadow. 2)The second approach treats the problem as a regression problem and predicts the width w, height h, rotation theta, and location (tx, ty) of a rectangle that best fits the collimator shadow.  For this approach the network is determining a continuous real-value variable output for {w, h, theta, tx, ty}.  The first layers of the network predict {w, h, theta, tx, ty} which are then fed into a spatial transformer layer which uses this info to determine the location of the estimate collimator shadow.  The spatial transformer layer uses the {w, h, theta, tx, ty} to determine an inverse transformation matrix which is then used to generate an image of the collimator. This is done by either by warping a binary square image or by using an implicit representation of a rectangle. The dice coefficient was used as a loss function.
